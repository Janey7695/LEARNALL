### 一、芯片特性
* 实时时钟计算年月日时分秒星期，直到2100年，并且有闰年调节功能
* 31x8位 通用暂存RAM
* 串行输入，使得管脚尽量减少
* 2.0v-5.5v宽电压范围操作
* 与时钟/RAM通讯只需要三根线：CE,I/O,SCLK。

### 二、管脚功能
[![](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_531a05e0751dd5c5b57eff914156084a.jpg)](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_531a05e0751dd5c5b57eff914156084a.jpg)

1. VCC1:备用电源
2. VCC2:主电源
3. x1,x2：32.768khz晶振接入脚
4. GND:接地
5. CE：复位引脚，使能引脚，使用读写时必须为高电平
6. 输入输出管脚，三态功能
7. SCLK：串行时钟输入引脚

### DS1302的寄存器以及片内RAM
有一个控制寄存器，12个日历、时钟寄存器和31个RAM。

#### 1.控制寄存器
用于存放DS1302的控制命令字，DS1302在CE（有的写作RST）引脚回到高电平后写入的__第一个字节__就是控制命令.

|D7|D6|D5|D4|D3|D2|D1|D0|
|---|---|---|---|---|---|---|---|
|1|RAM/CK|A4|A3|A2|A1|A0|RD/W|

* 其中D7位必须为1
* D6 RAM/CK位，=1为片内RAM，=0为时钟日历寄存器选择位
* D5~D1 地址位
* D0 读写选择，=0写、=1读

#### 2.时钟寄存器
[![](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_94ebc069b11d23c228ad9f1792a01ce0.jpg)](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_94ebc069b11d23c228ad9f1792a01ce0.jpg)
[![](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_2a6db18ee627f3e6c31b7e646ef00a8d.jpg)](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_2a6db18ee627f3e6c31b7e646ef00a8d.jpg)
[![](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_44ecdd3281934c301532060af4494b5e.jpg)](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_44ecdd3281934c301532060af4494b5e.jpg)
[![](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_a564c188f73a2dabe0ba93b6dfe70b64.jpg)](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_a564c188f73a2dabe0ba93b6dfe70b64.jpg)
ds1302有12个寄存器，其中七个与日历、时钟相关，存放的数据位BCD码的形式。
* CH ： 时钟暂停/运行标志位，=1暂停，=0运行
* WP：ds1302默认打开了写保护位，因此如果我们要对其进行写操作，要手动关闭这个写保护位，=1开启写保护，=0关闭写保护
* 小时寄存器的D7 ：=1是12小时制、=0是24小时
* 小时寄存器的D5: =1是上午，=0是下午。

>什么是BCD码？
BCD码通过4位的二进制来表示1位十进制中的0-9这10个数码。

二进制转BCD码的方式：4位二进制码大于1001时，加6.

#### 3.片内RAM
ds1302里面有31个RAM，有2种操作方式：单字节方式和多字节方式。当控制命令字为C0H~FDH时为单字节读写方式，命令字的D1-D5用来选择对应的RAM单元，其中奇数为读操作，偶数为写操作；当控制命令字为FEH、FFH时为多字节操作（RAM突发模式），多字节操作可以一次把所有RAM单元内容进行读写。FEH为写操作，FFH为读操作。

### I/O数据输入输出
在控制命令字输入后的下一个SCLK时钟的上升沿时，数据被写入DS1302，数据输入从低位即位0开始。同理，在紧跟8位命令字后的下一个SCLK脉冲的下降沿读出DS1302的数据，也是从低到高位。

#### 1.单字节读写
时序图：
[![](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_1bcd6b90c625fefcf003b4794954badd.jpg)](http://112.124.31.67/wp-content/uploads/2020/07/wp_editor_md_1bcd6b90c625fefcf003b4794954badd.jpg)

ds1302是通过SPI串行总线跟单片机进行通信的，一次读写操作最少得读写2个字节，一个是控制命令字节，一个是要读或者写的数据。

因此根据上图可以看出来，只有在SCLk为低电平时，才能将CE的电平拉高，因此在进行操作前要先将SCLK电平拉低，然后将CE置高电平。接着在I/O上面放置要传送的电平信号，然后跳变SCLK。数据在SCLk上升沿时，ds1302读写数据，在SCLK下降沿时，ds1302放置数据到I/O上。
